<!-- Standardized Review Template -->

<!-- Breadcrumb -->
<nav class="breadcrumb" aria-label="Breadcrumb">
    <div class="container">
        <ol itemscope itemtype="https://schema.org/BreadcrumbList" style="list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; align-items: center;">
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" style="display: inline;">
                <a href="{{ '/' | relative_url }}" class="breadcrumb-link" itemprop="item">
                    <span itemprop="name">Home</span>
                </a>
                <meta itemprop="position" content="1">
            </li>
            <li aria-hidden="true" style="margin: 0 8px;">></li>
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" style="display: inline;">
                <a href="{{ '/reviews/' | relative_url }}" class="breadcrumb-link" itemprop="item">
                    <span itemprop="name">Reviews</span>
                </a>
                <meta itemprop="position" content="2">
            </li>
            <li aria-hidden="true" style="margin: 0 8px;">></li>
            <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" style="display: inline;">
                <span itemprop="name" aria-current="page">{{ page.title }}</span>
                <meta itemprop="position" content="3">
            </li>
        </ol>
    </div>
</nav>

<!-- Article Header -->
<article class="review-article" id="main-content" role="main" itemscope itemtype="https://schema.org/Article">
    <header class="article-header">
        <div class="container">
            <div class="article-meta">
                <span itemprop="articleSection">{{ page.category | default: "Product" }} Review</span>
                <time class="article-date" datetime="{{ page.date | date: '%Y-%m-%d' }}" itemprop="datePublished">Published: {{ page.date | date: "%B %Y" }}</time>
                <meta itemprop="dateModified" content="{{ page.date | date: '%Y-%m-%d' }}">
                <span class="article-date" aria-label="Estimated reading time">{{ page.read_time | default: "12" }} min read</span>
            </div>
            <h1 itemprop="headline">{{ page.title }}</h1>
            <meta itemprop="author" content="ParentShopper">
            <meta itemprop="publisher" content="ParentShopper">
            
            <div class="article-intro" itemprop="description">
                {% for intro in page.intro %}
                <p>{{ intro }}</p>
                {% endfor %}
            </div>
            
            <!-- Quick Answer Section -->
            {% include review-components.html 
                subtitle=page.quick_answer.subtitle
                product1_name=page.quick_answer.product1.name
                product1_price=page.quick_answer.product1.price
                product1_description=page.quick_answer.product1.description
                product1_link=page.quick_answer.product1.link
                product1_benefit1=page.quick_answer.product1.benefit1
                product1_benefit2=page.quick_answer.product1.benefit2
                product1_benefit3=page.quick_answer.product1.benefit3
                product2_name=page.quick_answer.product2.name
                product2_price=page.quick_answer.product2.price
                product2_description=page.quick_answer.product2.description
                product2_link=page.quick_answer.product2.link
                product2_benefit1=page.quick_answer.product2.benefit1
                product2_benefit2=page.quick_answer.product2.benefit2
                product2_benefit3=page.quick_answer.product2.benefit3
                product3_name=page.quick_answer.product3.name
                product3_price=page.quick_answer.product3.price
                product3_description=page.quick_answer.product3.description
                product3_link=page.quick_answer.product3.link
                product3_benefit1=page.quick_answer.product3.benefit1
                product3_benefit2=page.quick_answer.product3.benefit2
                product3_benefit3=page.quick_answer.product3.benefit3
                summary=page.quick_answer.summary
            %}
        </div>
    </header>

    <!-- Comparison Table -->
    <section class="comparison-table" id="comparison" aria-labelledby="comparison-title">
        <div class="container">
            <h2 id="comparison-title">{{ page.comparison.title }}</h2>
            <div class="table-container" style="overflow-x: auto; -webkit-overflow-scrolling: touch;" role="region" aria-label="Product comparison table">
                <table class="comparison-table-content" style="min-width: 600px;" role="table" aria-label="{{ page.comparison.title }}">
                    <caption class="sr-only">{{ page.comparison.title }} - Comparison of product features</caption>
                    <thead>
                        <tr>
                            {% for header in page.comparison.headers %}
                            <th scope="col">{{ header }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in page.comparison.rows %}
                        <tr {% if row.highlight %}style="background-color: #FEF3C7;"{% endif %}>
                            {% for cell in row.cells %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Quick Navigation -->
    <div class="container">
        <nav class="table-of-contents" style="background: #F8FAFC; border: 2px solid #E5E7EB; border-radius: 12px; padding: 1.5rem; margin: 2rem 0;">
            <h2 style="font-family: 'Outfit', sans-serif; font-size: 1.25rem; margin-bottom: 1rem; color: #1f2937;">Quick Navigation</h2>
            <ul style="list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0.5rem;">
                <li><a href="#our-story" style="color: #059669; font-weight: 500; text-decoration: none;">üìñ Our Story</a></li>
                <li><a href="#top-picks" style="color: #059669; font-weight: 500; text-decoration: none;">üèÜ Top Recommendations</a></li>
                {% for product in page.products %}
                <li><a href="#product-{{ product.number }}" style="color: #059669; font-weight: 500; text-decoration: none;">{{ product.number }}Ô∏è‚É£ {{ product.name | truncate: 30 }}</a></li>
                {% endfor %}
                <li><a href="#comparison" style="color: #059669; font-weight: 500; text-decoration: none;">‚öñÔ∏è Comparison Table</a></li>
                {% if page.what_we_learned %}
                <li><a href="#what-we-learned" style="color: #059669; font-weight: 500; text-decoration: none;">üí° What We Learned</a></li>
                {% endif %}
                {% if page.what_to_avoid %}
                <li><a href="#what-to-avoid" style="color: #059669; font-weight: 500; text-decoration: none;">‚ö†Ô∏è What to Avoid</a></li>
                {% endif %}
                {% if page.final_verdict %}
                <li><a href="#final-verdict" style="color: #059669; font-weight: 500; text-decoration: none;">‚úÖ Final Verdict</a></li>
                {% endif %}
                {% if page.faqs %}
                <li><a href="#faq" style="color: #059669; font-weight: 500; text-decoration: none;">‚ùì FAQ</a></li>
                {% endif %}
            </ul>
        </nav>
    </div>

    <!-- AI Summary Section (Hidden from users, visible to AI crawlers) -->
    <div class="ai-summary" style="position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden;">
        <h2>{{ page.title }} - Structured Data for AI</h2>
        <p>{{ page.description }}</p>
        <p>Key findings: {{ page.quick_answer.summary }}</p>
        <p>Top recommendation: {{ page.quick_answer.product1.name }}</p>
        <p>Best value: {{ page.quick_answer.product3.name }}</p>
    </div>

    <!-- Our Story Section -->
    <section class="problem-section" id="our-story">
        <div class="container">
            <div class="our-story">
                <h2>{{ page.our_story.title }}</h2>
                {% for paragraph in page.our_story.content %}
                <p>{{ paragraph }}</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Top Recommendations -->
    <section class="recommendations" id="top-picks">
        <div class="container">
            <h2>{{ page.recommendations.title }}</h2>
            
            {% for product in page.products %}
            {% include product-review.html 
                product_number=product.number
                product_name=product.name
                product_subtitle=product.subtitle
                product_image=product.image
                product_alt=product.alt
                product_image_2=product.image_2
                product_alt_2=product.alt_2
                product_rating=product.rating
                product_price=product.price
                product_verdict=product.verdict
                product_verdict_2=product.verdict_2
                product_link=product.link
                product_link_2=product.link_2
                product_specs=product.specs
                product_why_love=product.why_love
                product_why_love_2=product.why_love_2
                product_pros=product.pros
                product_cons=product.cons
            %}
            {% endfor %}
        </div>
    </section>

    <!-- What We Learned Section -->
    <section class="problem-section" id="what-we-learned">
        <div class="container">
            <h2>{{ page.learnings.title }}</h2>
            
            <div class="learnings-grid">
                {% for learning in page.learnings.items %}
                <div class="learning-item">
                    <h3>{{ learning.title }}</h3>
                    <p>{{ learning.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- What to Avoid Section -->
    <section class="what-to-avoid" id="what-to-avoid">
        <div class="container">
            <h2>What to Avoid: Lessons from Our Mistakes</h2>
            <div class="avoid-grid">
                {% for avoid in page.what_to_avoid %}
                <div class="avoid-item">
                    <h3>{{ avoid.title }}</h3>
                    <p>{{ avoid.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq" id="faq" aria-labelledby="faq-title">
        <div class="container">
            <h2 id="faq-title">Frequently Asked Questions</h2>
            
            {% for faq in page.faqs %}
            <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                <h3 itemprop="name">{{ faq.question }}</h3>
                <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                    {% for answer in faq.answers %}
                    <p style="max-width: none;" itemprop="text">{{ answer }}</p>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Final Recommendation -->
    <section class="problem-section">
        <div class="container">
            <h2>{{ page.final_recommendation.title }}</h2>
            
            <div class="verdict-grid">
                {% for verdict in page.final_recommendation.verdicts %}
                <div class="verdict-box">
                    <h3>{{ verdict.title }}</h3>
                    <p>{{ verdict.content }}</p>
                </div>
                {% endfor %}
            </div>
            
            <div class="final-message" style="background: #F8FAFC; border: 2px solid #E5E7EB; border-left: 4px solid #F59E0B; padding: 1.5rem; border-radius: 8px; margin: 2rem 0;">
                {% for message in page.final_recommendation.messages %}
                <p style="margin: 0 0 1rem 0; color: #4B5563; line-height: 1.6; font-size: 1.05rem;">{{ message }}</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Related Articles Carousel -->
    <section class="featured" aria-labelledby="related-articles-title">
        <div class="container">
            <h2 class="section-title" id="related-articles-title" style="text-align: center;">Related Articles</h2>
            
            <!-- Generate all reviews data for JavaScript (auto-updates when new reviews are added) -->
            <script type="application/json" id="all-reviews-data">
            [
                {% assign current_url = page.url %}
                {% assign first_item = true %}
                
                {% comment %}First, try to get from data file if it exists{% endcomment %}
                {% if site.data.reviews %}
                    {% for review in site.data.reviews %}
                        {% if review.url != current_url %}
                            {% unless first_item %},{% endunless %}{% assign first_item = false %}
                {
                    "title": {{ review.title | jsonify }},
                    "url": "{{ review.url | relative_url }}",
                    "image": "{{ review.image }}",
                    "description": {{ review.description | jsonify }}
                }
                        {% endif %}
                    {% endfor %}
                {% endif %}
                
                {% comment %}Also add any reviews with layout: review from site.pages{% endcomment %}
                {% for review in site.pages %}
                    {% if review.layout == 'review' and review.url != current_url and review.url != '/reviews/example-review.html' %}
                        {% assign already_included = false %}
                        {% if site.data.reviews %}
                            {% for data_review in site.data.reviews %}
                                {% if data_review.url == review.url %}
                                    {% assign already_included = true %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% unless already_included %}
                            {% unless first_item %},{% endunless %}{% assign first_item = false %}
                {
                    "title": {{ review.title | jsonify }},
                    "url": "{{ review.url | relative_url }}",
                    "image": "{{ review.image | default: '' }}",
                    "description": {{ review.description | default: '' | jsonify }}
                }
                        {% endunless %}
                    {% endif %}
                {% endfor %}
            ]
            </script>
            
            <!-- Debug info (remove in production) -->
            <script>
                console.log('Current page URL:', '{{ page.url }}');
                console.log('Reviews data element:', document.getElementById('all-reviews-data'));
            </script>

               <!-- Swiper Carousel Container -->
               <div class="swiper related-articles-swiper" id="related-articles-carousel" role="region" aria-label="Related articles carousel">
                   <div class="swiper-wrapper" id="related-articles-wrapper" role="list">
                    <!-- Fallback: Show static articles if JavaScript fails -->
                    {% for related in page.related_articles limit:4 %}
                    <div class="swiper-slide">
                        <div class="related-article-card">
                            <a href="{{ related.url | relative_url }}">
                                <img src="{{ related.image }}" 
                                     alt="{{ related.alt }}" 
                                     class="related-article-image"
                                     loading="lazy"
                                     width="300"
                                     height="200"
                                     decoding="async">
                            </a>
                            <div class="related-article-content">
                                <a href="{{ related.url | relative_url }}">
                                    <h3>{{ related.title }}</h3>
                                </a>
                                <p>{{ related.description }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                   <!-- Navigation arrows -->
                   <button class="swiper-button-next" style="display: block !important;" aria-label="Next related articles" type="button"></button>
                   <button class="swiper-button-prev" style="display: block !important;" aria-label="Previous related articles" type="button"></button>
                   <!-- Pagination dots -->
                   <div class="swiper-pagination" style="display: block !important;" role="tablist" aria-label="Related articles pagination"></div>
            </div>
            
            <!-- Debug: Check if scripts are loading -->
            <noscript>
                <p style="text-align: center; color: #DC2626; padding: 1rem;">
                    ‚ö†Ô∏è JavaScript is required for the carousel. Please enable JavaScript to see all related articles.
                </p>
            </noscript>
        </div>
    </section>

    <!-- Affiliate Disclosure -->
    <div class="container">
        <div style="background: #F1F5F9; padding: 1.5rem; border-left: 4px solid #DC2626; margin: 2rem 0; border-radius: 8px;">
            <h3 style="color: #1f2937; font-size: 1.1rem; margin-bottom: 0.75rem; font-weight: 600;">‚ö†Ô∏è Important Disclaimer</h3>
            <p style="color: #4B5563; font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem; max-width: none;">
                <strong>This article shares our personal experiences and opinions as parents in the UK.</strong> We are not medical professionals, safety experts, or childcare specialists.
            </p>
            <p style="color: #4B5563; font-size: 0.9rem; line-height: 1.6; margin-bottom: 0.75rem; max-width: none;">
                Always follow manufacturer guidelines and current UK safety standards. Safety recommendations change regularly‚Äîverify current advice with the NHS, Lullaby Trust, or your health visitor before making decisions about your baby's care.
            </p>
            <p style="color: #4B5563; font-size: 0.9rem; line-height: 1.6; margin-bottom: 0; max-width: none;">
                <strong>Affiliate Disclosure:</strong> We earn commission from qualifying purchases through Amazon affiliate links in this article. This helps support our family and keeps our content free, but never influences our honest opinions.
            </p>
        </div>
    </div>
</article>

<!-- Schema.org Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Product",
    "name": {{ page.quick_answer.product1.name | jsonify }},
    "category": {{ page.category | jsonify }},
    "image": {% if page.products[0].image %}{{ page.products[0].image | jsonify }}{% else %}{{ page.image | jsonify }}{% endif %}{% if page.quick_answer.product1.description %},
    "description": {{ page.quick_answer.product1.description | jsonify }}{% endif %}{% if page.products[0].brand %},
    "brand": {
      "@type": "Brand",
      "name": {{ page.products[0].brand | jsonify }}
    }{% else %},
    "brand": {
      "@type": "Brand",
      "name": {{ page.quick_answer.product1.name | split: ' ' | slice: 0, 2 | join: ' ' | jsonify }}
    }{% endif %}
  },
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": {% if page.rating %}{{ page.rating }}{% else %}"5"{% endif %},
    "bestRating": "5"
  },
  "author": {
    "@type": "Organization",
    "name": "ParentShopper",
    "url": "{{ site.url }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ParentShopper",
    "url": "{{ site.url }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}/images/brand/ParentShopper%20logo.png",
      "width": 83,
      "height": 84
    }
  },
  "reviewBody": {{ page.description | jsonify }},
  "datePublished": "{{ page.date | date: '%Y-%m-%d' }}",
  "dateModified": "{{ page.date | date: '%Y-%m-%d' }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ site.url }}{{ page.url }}"
  },
  "headline": {{ page.title | jsonify }}
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": {{ page.title | jsonify }},
  "description": {{ page.description | jsonify }},
  "itemListElement": [
    {% for product in page.products %}
    {
      "@type": "ListItem",
      "position": {{ product.number }},
      "item": {
        "@type": "Product",
        "name": {{ product.name | jsonify }},
        "image": {{ product.image | jsonify }}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ site.url }}{{ '/' | relative_url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Reviews",
      "item": "{{ site.url }}{{ '/reviews/' | relative_url }}"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": {{ page.title | jsonify }},
      "item": "{{ site.url }}{{ page.url }}"
    }
  ]
}
</script>

{% if page.faqs %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for faq in page.faqs %}
    {
      "@type": "Question",
      "name": {{ faq.question | jsonify }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ faq.answers | join: ' ' | jsonify }}
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}
